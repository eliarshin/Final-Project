from unicodedata import name
from urllib import response
from urllib.parse import urljoin, urlparse
import requests
import threading, time
from pyparsing import Word
from rich.console import Console
from art import *
import requests
import ftplib
import re 
from threading import Thread
from bs4 import BeautifulSoup

#from BeautifulSoup import BeautifulSoup

console = Console()

class vulnerability_scanner:
    def __init__(vs):
        vs.url = "xss-quiz.int21h.jp"
        vs.resp_from_url = ""
        vs.parsed_html = ""
        vs.app = ""

        vs.script_tag = ""
        vs.form_tag = ""
        vs.input_tag = ""

        vs.extracted_script =[]
        vs.extracted_form =[]

        vs.post_data_dict ={}

    def requests(vs):
        vs.resp_from_url = requests.get("http://" +vs.url)
        #print(vs.resp_from_url.content)
    def url_response(vs):
        vulnerability_scanner.requests(vs)
        vs.prased_html = BeautifulSoup(vs.resp_from_url.content,"html.parser")
        
        #print(script_tag)
    def find_vulnerabilities(vs):
        vs.script_tag = vs.prased_html.find_all("script")
        vs.form_tag = vs.prased_html.find_all("form")  
        vs.input_tag = vs.prased_html.find_all("input")

        for form in vs.form_tag:
            action=form.get("action")
            post_url = "http://"+vs.url+action
            print(action)
            method = form.get("method")
            print(method)
            input_list = form.find_all("input")
            print(input_list)
            for input in input_list:
                input_name = input.get("name")
                input_type = input.get("type")
                input_value = input.get("value")
                if input_type =='text':
                    input_value = 'test'
                vs.post_data_dict[input_name] = input_value
            result = requests.post(post_url, data = vs.post_data_dict)## here the problem
            print(result.content)


        # for input in vs.form_tag:
        #      inp = input.get("action")
        #      print(inp)
        # for inp in vs.input_tag:
        #      put = inp.get("name")
        #      input_type=inp.get("type")
        #      print(input_type)
        # for form in vs.form_tag:
        #     action = form.get("action")
        #     print("vs url = ",vs.url)
        #     print("vs action = ",action)
        #     urjoin= vs.url+action
        #     #print(join)
        #     method=form.get("method")
        #     #print(method)



        # for form in vs.form_tag:
        #     act = form.get("action")
        #     print(act)

        #print(vs.form_tag)
        #print(form_tag)
    #def extract_features(vs):




scan = vulnerability_scanner() 
scan.url_response()
scan.find_vulnerabilities()
#scan.extract_features()
#print(scan.url)
#scan.__init__()
#scan.parsed_html()
